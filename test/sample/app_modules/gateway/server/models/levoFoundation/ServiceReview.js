"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

const {
  Types,
  Validators,
  Processors,
  Generators,
  Errors: {
    BusinessError,
    DataValidationError,
    DsOperationError
  },
  Utils: {
    Lang: {
      isNothing
    }
  }
} = require('@k-suite/oolong');

module.exports = (db, BaseEntityModel) => {
  const ServiceReviewSpec = class extends BaseEntityModel {
    static async applyModifiers_(context, isUpdating) {
      let {
        raw,
        latest,
        existing,
        i18n
      } = context;
      existing || (existing = {});

      if (!isNothing(latest['rating'])) {
        if (!(Validators.min(latest['rating'], 1) && Validators.max(latest['rating'], 5))) {
          throw new DataValidationError('Invalid "rating".', {
            entity: this.meta.name,
            field: 'rating'
          });
        }
      }

      return context;
    }

  };
  ServiceReviewSpec.db = db;
  ServiceReviewSpec.meta = {
    "schemaName": "levoFoundation",
    "name": "serviceReview",
    "keyField": "id",
    "fields": {
      "id": {
        "type": "integer",
        "auto": true,
        "writeOnce": true,
        "displayName": "Id",
        "autoIncrementId": true,
        "createByDb": true
      },
      "rating": {
        "type": "integer",
        "digits": 1,
        "optional": true,
        "modifiers": [{
          "oolType": "Validator",
          "name": "min",
          "args": [1]
        }, {
          "oolType": "Validator",
          "name": "max",
          "args": [5]
        }],
        "displayName": "Rating"
      },
      "comment": {
        "type": "text",
        "displayName": "Comment"
      },
      "createdAt": {
        "type": "datetime",
        "auto": true,
        "readOnly": true,
        "writeOnce": true,
        "displayName": "Created At",
        "isCreateTimestamp": true,
        "createByDb": true
      },
      "service": {
        "type": "integer",
        "displayName": "serviceId",
        "createByDb": true
      }
    },
    "features": {
      "autoId": {
        "field": "id"
      },
      "createTimestamp": {
        "field": "createdAt"
      }
    },
    "uniqueKeys": [["id"]],
    "associations": {
      "service": {
        "entity": "service",
        "isList": false
      },
      "replies": {
        "entity": "reviewReply",
        "isList": true,
        "remoteField": "reviewTopic",
        "optional": true
      }
    },
    "fieldDependencies": {
      "id": ["id"],
      "createdAt": ["createdAt"],
      "rating": []
    }
  };
  return Object.assign(ServiceReviewSpec, {});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbHMvbGV2b0ZvdW5kYXRpb24vU2VydmljZVJldmlldy5qcyJdLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsIlR5cGVzIiwiVmFsaWRhdG9ycyIsIlByb2Nlc3NvcnMiLCJHZW5lcmF0b3JzIiwiRXJyb3JzIiwiQnVzaW5lc3NFcnJvciIsIkRhdGFWYWxpZGF0aW9uRXJyb3IiLCJEc09wZXJhdGlvbkVycm9yIiwiVXRpbHMiLCJMYW5nIiwiaXNOb3RoaW5nIiwibW9kdWxlIiwiZXhwb3J0cyIsImRiIiwiQmFzZUVudGl0eU1vZGVsIiwiU2VydmljZVJldmlld1NwZWMiLCJhcHBseU1vZGlmaWVyc18iLCJjb250ZXh0IiwiaXNVcGRhdGluZyIsInJhdyIsImxhdGVzdCIsImV4aXN0aW5nIiwiaTE4biIsIm1pbiIsIm1heCIsImVudGl0eSIsIm1ldGEiLCJuYW1lIiwiZmllbGQiLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBUUMsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBRUEsTUFBTTtBQUNGQyxFQUFBQSxLQURFO0FBRUZDLEVBQUFBLFVBRkU7QUFHRkMsRUFBQUEsVUFIRTtBQUlGQyxFQUFBQSxVQUpFO0FBS0ZDLEVBQUFBLE1BQU0sRUFBRTtBQUFFQyxJQUFBQSxhQUFGO0FBQWlCQyxJQUFBQSxtQkFBakI7QUFBc0NDLElBQUFBO0FBQXRDLEdBTE47QUFNRkMsRUFBQUEsS0FBSyxFQUFFO0FBQUVDLElBQUFBLElBQUksRUFBRTtBQUFFQyxNQUFBQTtBQUFGO0FBQVI7QUFOTCxJQU9GWCxPQUFPLENBQUMsaUJBQUQsQ0FQWDs7QUFVQVksTUFBTSxDQUFDQyxPQUFQLEdBQWlCLENBQUNDLEVBQUQsRUFBS0MsZUFBTCxLQUF5QjtBQUN0QyxRQUFNQyxpQkFBaUIsR0FBRyxjQUFjRCxlQUFkLENBQThCO0FBT3BELGlCQUFhRSxlQUFiLENBQTZCQyxPQUE3QixFQUFzQ0MsVUFBdEMsRUFBa0Q7QUFDOUMsVUFBSTtBQUFDQyxRQUFBQSxHQUFEO0FBQU1DLFFBQUFBLE1BQU47QUFBY0MsUUFBQUEsUUFBZDtBQUF3QkMsUUFBQUE7QUFBeEIsVUFBZ0NMLE9BQXBDO0FBQ0FJLE1BQUFBLFFBQVEsS0FBS0EsUUFBUSxHQUFHLEVBQWhCLENBQVI7O0FBQ0EsVUFBSSxDQUFDWCxTQUFTLENBQUNVLE1BQU0sQ0FBQyxRQUFELENBQVAsQ0FBZCxFQUFrQztBQUU5QixZQUFJLEVBQUVuQixVQUFVLENBQUNzQixHQUFYLENBQWVILE1BQU0sQ0FBQyxRQUFELENBQXJCLEVBQWlDLENBQWpDLEtBQXVDbkIsVUFBVSxDQUFDdUIsR0FBWCxDQUFlSixNQUFNLENBQUMsUUFBRCxDQUFyQixFQUFpQyxDQUFqQyxDQUF6QyxDQUFKLEVBQW1GO0FBQy9FLGdCQUFNLElBQUlkLG1CQUFKLENBQXdCLG1CQUF4QixFQUE2QztBQUMvQ21CLFlBQUFBLE1BQU0sRUFBRSxLQUFLQyxJQUFMLENBQVVDLElBRDZCO0FBRS9DQyxZQUFBQSxLQUFLLEVBQUU7QUFGd0MsV0FBN0MsQ0FBTjtBQUlIO0FBQ0o7O0FBQ0QsYUFBT1gsT0FBUDtBQUNIOztBQXBCbUQsR0FBeEQ7QUF1QkFGLEVBQUFBLGlCQUFpQixDQUFDRixFQUFsQixHQUF1QkEsRUFBdkI7QUFDQUUsRUFBQUEsaUJBQWlCLENBQUNXLElBQWxCLEdBQXlCO0FBQ3JCLGtCQUFjLGdCQURPO0FBRXJCLFlBQVEsZUFGYTtBQUdyQixnQkFBWSxJQUhTO0FBSXJCLGNBQVU7QUFDTixZQUFNO0FBQ0YsZ0JBQVEsU0FETjtBQUVGLGdCQUFRLElBRk47QUFHRixxQkFBYSxJQUhYO0FBSUYsdUJBQWUsSUFKYjtBQUtGLDJCQUFtQixJQUxqQjtBQU1GLHNCQUFjO0FBTlosT0FEQTtBQVNOLGdCQUFVO0FBQ04sZ0JBQVEsU0FERjtBQUVOLGtCQUFVLENBRko7QUFHTixvQkFBWSxJQUhOO0FBSU4scUJBQWEsQ0FDVDtBQUNJLHFCQUFXLFdBRGY7QUFFSSxrQkFBUSxLQUZaO0FBR0ksa0JBQVEsQ0FDSixDQURJO0FBSFosU0FEUyxFQVFUO0FBQ0kscUJBQVcsV0FEZjtBQUVJLGtCQUFRLEtBRlo7QUFHSSxrQkFBUSxDQUNKLENBREk7QUFIWixTQVJTLENBSlA7QUFvQk4sdUJBQWU7QUFwQlQsT0FUSjtBQStCTixpQkFBVztBQUNQLGdCQUFRLE1BREQ7QUFFUCx1QkFBZTtBQUZSLE9BL0JMO0FBbUNOLG1CQUFhO0FBQ1QsZ0JBQVEsVUFEQztBQUVULGdCQUFRLElBRkM7QUFHVCxvQkFBWSxJQUhIO0FBSVQscUJBQWEsSUFKSjtBQUtULHVCQUFlLFlBTE47QUFNVCw2QkFBcUIsSUFOWjtBQU9ULHNCQUFjO0FBUEwsT0FuQ1A7QUE0Q04saUJBQVc7QUFDUCxnQkFBUSxTQUREO0FBRVAsdUJBQWUsV0FGUjtBQUdQLHNCQUFjO0FBSFA7QUE1Q0wsS0FKVztBQXNEckIsZ0JBQVk7QUFDUixnQkFBVTtBQUNOLGlCQUFTO0FBREgsT0FERjtBQUlSLHlCQUFtQjtBQUNmLGlCQUFTO0FBRE07QUFKWCxLQXREUztBQThEckIsa0JBQWMsQ0FDVixDQUNJLElBREosQ0FEVSxDQTlETztBQW1FckIsb0JBQWdCO0FBQ1osaUJBQVc7QUFDUCxrQkFBVSxTQURIO0FBRVAsa0JBQVU7QUFGSCxPQURDO0FBS1osaUJBQVc7QUFDUCxrQkFBVSxhQURIO0FBRVAsa0JBQVUsSUFGSDtBQUdQLHVCQUFlLGFBSFI7QUFJUCxvQkFBWTtBQUpMO0FBTEMsS0FuRUs7QUErRXJCLHlCQUFxQjtBQUNqQixZQUFNLENBQ0YsSUFERSxDQURXO0FBSWpCLG1CQUFhLENBQ1QsV0FEUyxDQUpJO0FBT2pCLGdCQUFVO0FBUE87QUEvRUEsR0FBekI7QUEwRkEsU0FBT0csTUFBTSxDQUFDQyxNQUFQLENBQWNmLGlCQUFkLEVBQWlDLEVBQWpDLENBQVA7QUFDSCxDQXBIRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcblxuY29uc3QgeyBcbiAgICBUeXBlcyxcbiAgICBWYWxpZGF0b3JzLCBcbiAgICBQcm9jZXNzb3JzLCBcbiAgICBHZW5lcmF0b3JzLCBcbiAgICBFcnJvcnM6IHsgQnVzaW5lc3NFcnJvciwgRGF0YVZhbGlkYXRpb25FcnJvciwgRHNPcGVyYXRpb25FcnJvciB9LCBcbiAgICBVdGlsczogeyBMYW5nOiB7IGlzTm90aGluZyB9IH0gXG59ID0gcmVxdWlyZSgnQGstc3VpdGUvb29sb25nJyk7XG4gXG5cbm1vZHVsZS5leHBvcnRzID0gKGRiLCBCYXNlRW50aXR5TW9kZWwpID0+IHtcbiAgICBjb25zdCBTZXJ2aWNlUmV2aWV3U3BlYyA9IGNsYXNzIGV4dGVuZHMgQmFzZUVudGl0eU1vZGVsIHsgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBseWluZyBwcmVkZWZpbmVkIG1vZGlmaWVycyB0byBlbnRpdHkgZmllbGRzLlxuICAgICAgICAgKiBAcGFyYW0gY29udGV4dFxuICAgICAgICAgKiBAcGFyYW0gaXNVcGRhdGluZ1xuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBhc3luYyBhcHBseU1vZGlmaWVyc18oY29udGV4dCwgaXNVcGRhdGluZykge1xuICAgICAgICAgICAgbGV0IHtyYXcsIGxhdGVzdCwgZXhpc3RpbmcsIGkxOG59ID0gY29udGV4dDtcbiAgICAgICAgICAgIGV4aXN0aW5nIHx8IChleGlzdGluZyA9IHt9KTtcbiAgICAgICAgICAgIGlmICghaXNOb3RoaW5nKGxhdGVzdFsncmF0aW5nJ10pKSB7XG4gICAgICAgICAgICAgICAgLy9WYWxpZGF0aW5nIFwicmF0aW5nXCJcbiAgICAgICAgICAgICAgICBpZiAoIShWYWxpZGF0b3JzLm1pbihsYXRlc3RbJ3JhdGluZyddLCAxKSAmJiBWYWxpZGF0b3JzLm1heChsYXRlc3RbJ3JhdGluZyddLCA1KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IERhdGFWYWxpZGF0aW9uRXJyb3IoJ0ludmFsaWQgXCJyYXRpbmdcIi4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IHRoaXMubWV0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdyYXRpbmcnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFNlcnZpY2VSZXZpZXdTcGVjLmRiID0gZGI7XG4gICAgU2VydmljZVJldmlld1NwZWMubWV0YSA9IHtcbiAgICAgICAgXCJzY2hlbWFOYW1lXCI6IFwibGV2b0ZvdW5kYXRpb25cIixcbiAgICAgICAgXCJuYW1lXCI6IFwic2VydmljZVJldmlld1wiLFxuICAgICAgICBcImtleUZpZWxkXCI6IFwiaWRcIixcbiAgICAgICAgXCJmaWVsZHNcIjoge1xuICAgICAgICAgICAgXCJpZFwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiaW50ZWdlclwiLFxuICAgICAgICAgICAgICAgIFwiYXV0b1wiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwid3JpdGVPbmNlXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcIklkXCIsXG4gICAgICAgICAgICAgICAgXCJhdXRvSW5jcmVtZW50SWRcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmF0aW5nXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJpbnRlZ2VyXCIsXG4gICAgICAgICAgICAgICAgXCJkaWdpdHNcIjogMSxcbiAgICAgICAgICAgICAgICBcIm9wdGlvbmFsXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJtb2RpZmllcnNcIjogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJWYWxpZGF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIm1pblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmdzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwib29sVHlwZVwiOiBcIlZhbGlkYXRvclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwibWF4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFyZ3NcIjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDVcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcIlJhdGluZ1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjb21tZW50XCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcIkNvbW1lbnRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY3JlYXRlZEF0XCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJkYXRldGltZVwiLFxuICAgICAgICAgICAgICAgIFwiYXV0b1wiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwicmVhZE9ubHlcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcIndyaXRlT25jZVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJDcmVhdGVkIEF0XCIsXG4gICAgICAgICAgICAgICAgXCJpc0NyZWF0ZVRpbWVzdGFtcFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiY3JlYXRlQnlEYlwiOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJpbnRlZ2VyXCIsXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcInNlcnZpY2VJZFwiLFxuICAgICAgICAgICAgICAgIFwiY3JlYXRlQnlEYlwiOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiZmVhdHVyZXNcIjoge1xuICAgICAgICAgICAgXCJhdXRvSWRcIjoge1xuICAgICAgICAgICAgICAgIFwiZmllbGRcIjogXCJpZFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjcmVhdGVUaW1lc3RhbXBcIjoge1xuICAgICAgICAgICAgICAgIFwiZmllbGRcIjogXCJjcmVhdGVkQXRcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInVuaXF1ZUtleXNcIjogW1xuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIFwiaWRcIlxuICAgICAgICAgICAgXVxuICAgICAgICBdLFxuICAgICAgICBcImFzc29jaWF0aW9uc1wiOiB7XG4gICAgICAgICAgICBcInNlcnZpY2VcIjoge1xuICAgICAgICAgICAgICAgIFwiZW50aXR5XCI6IFwic2VydmljZVwiLFxuICAgICAgICAgICAgICAgIFwiaXNMaXN0XCI6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJyZXBsaWVzXCI6IHtcbiAgICAgICAgICAgICAgICBcImVudGl0eVwiOiBcInJldmlld1JlcGx5XCIsXG4gICAgICAgICAgICAgICAgXCJpc0xpc3RcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcInJlbW90ZUZpZWxkXCI6IFwicmV2aWV3VG9waWNcIixcbiAgICAgICAgICAgICAgICBcIm9wdGlvbmFsXCI6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJmaWVsZERlcGVuZGVuY2llc1wiOiB7XG4gICAgICAgICAgICBcImlkXCI6IFtcbiAgICAgICAgICAgICAgICBcImlkXCJcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBcImNyZWF0ZWRBdFwiOiBbXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIlxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIFwicmF0aW5nXCI6IFtdXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oU2VydmljZVJldmlld1NwZWMsIHt9KTtcbn07Il19
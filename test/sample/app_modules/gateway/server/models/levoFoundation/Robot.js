"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

const {
  Types,
  Validators,
  Processors,
  Generators,
  Errors: {
    BusinessError,
    DataValidationError,
    DsOperationError
  },
  Utils: {
    Lang: {
      isNothing
    }
  }
} = require('@k-suite/oolong');

module.exports = (db, BaseEntityModel) => {
  const RobotSpec = class extends BaseEntityModel {
    static async applyModifiers_(context, isUpdating) {
      let {
        raw,
        latest,
        existing,
        i18n
      } = context;
      existing || (existing = {});

      if (!isNothing(latest['avatar'])) {
        if (!Validators.isURL(latest['avatar'])) {
          throw new DataValidationError('Invalid "avatar".', {
            entity: this.meta.name,
            field: 'avatar'
          });
        }
      }

      if (!isNothing(latest['video'])) {
        if (!Validators.isURL(latest['video'])) {
          throw new DataValidationError('Invalid "video".', {
            entity: this.meta.name,
            field: 'video'
          });
        }
      }

      if (!isNothing(latest['voice'])) {
        if (!Validators.isURL(latest['voice'])) {
          throw new DataValidationError('Invalid "voice".', {
            entity: this.meta.name,
            field: 'voice'
          });
        }
      }

      if (!isNothing(latest['email'])) {
        if (!Validators.isEmail(latest['email'])) {
          throw new DataValidationError('Invalid "email".', {
            entity: this.meta.name,
            field: 'email'
          });
        }
      }

      return context;
    }

  };
  RobotSpec.db = db;
  RobotSpec.meta = {
    "schemaName": "levoFoundation",
    "name": "robot",
    "keyField": "code",
    "fields": {
      "code": {
        "type": "text",
        "maxLength": 20,
        "subClass": ["code"],
        "displayName": "Code",
        "createByDb": true
      },
      "introduction": {
        "type": "text",
        "displayName": "Introduction"
      },
      "voiceScript": {
        "type": "text",
        "displayName": "Voice Script"
      },
      "avatar": {
        "type": "text",
        "maxLength": 2000,
        "modifiers": [{
          "oolType": "Validator",
          "name": "isURL"
        }],
        "subClass": ["url"],
        "displayName": "Avatar",
        "createByDb": true
      },
      "images": {
        "type": "array",
        "optional": true,
        "displayName": "Images"
      },
      "video": {
        "type": "text",
        "maxLength": 2000,
        "optional": true,
        "modifiers": [{
          "oolType": "Validator",
          "name": "isURL"
        }],
        "subClass": ["url"],
        "displayName": "Video"
      },
      "voice": {
        "type": "text",
        "maxLength": 2000,
        "optional": true,
        "modifiers": [{
          "oolType": "Validator",
          "name": "isURL"
        }],
        "subClass": ["url"],
        "displayName": "Voice"
      },
      "email": {
        "type": "text",
        "maxLength": 200,
        "modifiers": [{
          "oolType": "Validator",
          "name": "isEmail"
        }],
        "subClass": ["email"],
        "displayName": "Email",
        "createByDb": true
      },
      "firstname": {
        "type": "text",
        "maxLength": 40,
        "subClass": ["name"],
        "displayName": "Firstname",
        "createByDb": true
      },
      "lastname": {
        "type": "text",
        "maxLength": 40,
        "subClass": ["name"],
        "displayName": "Lastname",
        "createByDb": true
      },
      "nickname": {
        "type": "text",
        "maxLength": 40,
        "subClass": ["name"],
        "displayName": "Nickname",
        "createByDb": true
      },
      "expertTitle": {
        "type": "text",
        "maxLength": 40,
        "subClass": ["name"],
        "displayName": "Expert Title",
        "createByDb": true
      },
      "address": {
        "type": "text",
        "maxLength": 200,
        "displayName": "Address",
        "createByDb": true
      },
      "createdAt": {
        "type": "datetime",
        "auto": true,
        "readOnly": true,
        "writeOnce": true,
        "displayName": "Created At",
        "isCreateTimestamp": true,
        "createByDb": true
      },
      "updatedAt": {
        "type": "datetime",
        "readOnly": true,
        "forceUpdate": true,
        "optional": true,
        "displayName": "Updated At",
        "isUpdateTimestamp": true,
        "updateByDb": true
      },
      "isDeleted": {
        "type": "boolean",
        "default": false,
        "readOnly": true,
        "displayName": "Is Deleted"
      },
      "service": {
        "type": "integer",
        "displayName": "serviceId",
        "createByDb": true
      },
      "gender": {
        "type": "text",
        "maxLength": 20,
        "subClass": ["code"],
        "displayName": "genderCode",
        "createByDb": true
      }
    },
    "features": {
      "createTimestamp": {
        "field": "createdAt"
      },
      "updateTimestamp": {
        "field": "updatedAt"
      },
      "logicalDeletion": {
        "field": "isDeleted",
        "value": true
      }
    },
    "uniqueKeys": [["code"]],
    "associations": {
      "service": {
        "entity": "service",
        "isList": false
      },
      "gender": {
        "entity": "gender",
        "isList": false
      },
      "contacts": {
        "entity": "robotContact",
        "isList": true,
        "remoteField": "robot"
      }
    },
    "fieldDependencies": {
      "createdAt": ["createdAt"]
    }
  };
  return Object.assign(RobotSpec, {});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbHMvbGV2b0ZvdW5kYXRpb24vUm9ib3QuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJUeXBlcyIsIlZhbGlkYXRvcnMiLCJQcm9jZXNzb3JzIiwiR2VuZXJhdG9ycyIsIkVycm9ycyIsIkJ1c2luZXNzRXJyb3IiLCJEYXRhVmFsaWRhdGlvbkVycm9yIiwiRHNPcGVyYXRpb25FcnJvciIsIlV0aWxzIiwiTGFuZyIsImlzTm90aGluZyIsIm1vZHVsZSIsImV4cG9ydHMiLCJkYiIsIkJhc2VFbnRpdHlNb2RlbCIsIlJvYm90U3BlYyIsImFwcGx5TW9kaWZpZXJzXyIsImNvbnRleHQiLCJpc1VwZGF0aW5nIiwicmF3IiwibGF0ZXN0IiwiZXhpc3RpbmciLCJpMThuIiwiaXNVUkwiLCJlbnRpdHkiLCJtZXRhIiwibmFtZSIsImZpZWxkIiwiaXNFbWFpbCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU07QUFBRUEsRUFBQUE7QUFBRixJQUFRQyxPQUFPLENBQUMsVUFBRCxDQUFyQjs7QUFFQSxNQUFNO0FBQ0ZDLEVBQUFBLEtBREU7QUFFRkMsRUFBQUEsVUFGRTtBQUdGQyxFQUFBQSxVQUhFO0FBSUZDLEVBQUFBLFVBSkU7QUFLRkMsRUFBQUEsTUFBTSxFQUFFO0FBQUVDLElBQUFBLGFBQUY7QUFBaUJDLElBQUFBLG1CQUFqQjtBQUFzQ0MsSUFBQUE7QUFBdEMsR0FMTjtBQU1GQyxFQUFBQSxLQUFLLEVBQUU7QUFBRUMsSUFBQUEsSUFBSSxFQUFFO0FBQUVDLE1BQUFBO0FBQUY7QUFBUjtBQU5MLElBT0ZYLE9BQU8sQ0FBQyxpQkFBRCxDQVBYOztBQVVBWSxNQUFNLENBQUNDLE9BQVAsR0FBaUIsQ0FBQ0MsRUFBRCxFQUFLQyxlQUFMLEtBQXlCO0FBQ3RDLFFBQU1DLFNBQVMsR0FBRyxjQUFjRCxlQUFkLENBQThCO0FBTzVDLGlCQUFhRSxlQUFiLENBQTZCQyxPQUE3QixFQUFzQ0MsVUFBdEMsRUFBa0Q7QUFDOUMsVUFBSTtBQUFDQyxRQUFBQSxHQUFEO0FBQU1DLFFBQUFBLE1BQU47QUFBY0MsUUFBQUEsUUFBZDtBQUF3QkMsUUFBQUE7QUFBeEIsVUFBZ0NMLE9BQXBDO0FBQ0FJLE1BQUFBLFFBQVEsS0FBS0EsUUFBUSxHQUFHLEVBQWhCLENBQVI7O0FBQ0EsVUFBSSxDQUFDWCxTQUFTLENBQUNVLE1BQU0sQ0FBQyxRQUFELENBQVAsQ0FBZCxFQUFrQztBQUU5QixZQUFJLENBQUNuQixVQUFVLENBQUNzQixLQUFYLENBQWlCSCxNQUFNLENBQUMsUUFBRCxDQUF2QixDQUFMLEVBQXlDO0FBQ3JDLGdCQUFNLElBQUlkLG1CQUFKLENBQXdCLG1CQUF4QixFQUE2QztBQUMvQ2tCLFlBQUFBLE1BQU0sRUFBRSxLQUFLQyxJQUFMLENBQVVDLElBRDZCO0FBRS9DQyxZQUFBQSxLQUFLLEVBQUU7QUFGd0MsV0FBN0MsQ0FBTjtBQUlIO0FBQ0o7O0FBQ0QsVUFBSSxDQUFDakIsU0FBUyxDQUFDVSxNQUFNLENBQUMsT0FBRCxDQUFQLENBQWQsRUFBaUM7QUFFN0IsWUFBSSxDQUFDbkIsVUFBVSxDQUFDc0IsS0FBWCxDQUFpQkgsTUFBTSxDQUFDLE9BQUQsQ0FBdkIsQ0FBTCxFQUF3QztBQUNwQyxnQkFBTSxJQUFJZCxtQkFBSixDQUF3QixrQkFBeEIsRUFBNEM7QUFDOUNrQixZQUFBQSxNQUFNLEVBQUUsS0FBS0MsSUFBTCxDQUFVQyxJQUQ0QjtBQUU5Q0MsWUFBQUEsS0FBSyxFQUFFO0FBRnVDLFdBQTVDLENBQU47QUFJSDtBQUNKOztBQUNELFVBQUksQ0FBQ2pCLFNBQVMsQ0FBQ1UsTUFBTSxDQUFDLE9BQUQsQ0FBUCxDQUFkLEVBQWlDO0FBRTdCLFlBQUksQ0FBQ25CLFVBQVUsQ0FBQ3NCLEtBQVgsQ0FBaUJILE1BQU0sQ0FBQyxPQUFELENBQXZCLENBQUwsRUFBd0M7QUFDcEMsZ0JBQU0sSUFBSWQsbUJBQUosQ0FBd0Isa0JBQXhCLEVBQTRDO0FBQzlDa0IsWUFBQUEsTUFBTSxFQUFFLEtBQUtDLElBQUwsQ0FBVUMsSUFENEI7QUFFOUNDLFlBQUFBLEtBQUssRUFBRTtBQUZ1QyxXQUE1QyxDQUFOO0FBSUg7QUFDSjs7QUFDRCxVQUFJLENBQUNqQixTQUFTLENBQUNVLE1BQU0sQ0FBQyxPQUFELENBQVAsQ0FBZCxFQUFpQztBQUU3QixZQUFJLENBQUNuQixVQUFVLENBQUMyQixPQUFYLENBQW1CUixNQUFNLENBQUMsT0FBRCxDQUF6QixDQUFMLEVBQTBDO0FBQ3RDLGdCQUFNLElBQUlkLG1CQUFKLENBQXdCLGtCQUF4QixFQUE0QztBQUM5Q2tCLFlBQUFBLE1BQU0sRUFBRSxLQUFLQyxJQUFMLENBQVVDLElBRDRCO0FBRTlDQyxZQUFBQSxLQUFLLEVBQUU7QUFGdUMsV0FBNUMsQ0FBTjtBQUlIO0FBQ0o7O0FBQ0QsYUFBT1YsT0FBUDtBQUNIOztBQS9DMkMsR0FBaEQ7QUFrREFGLEVBQUFBLFNBQVMsQ0FBQ0YsRUFBVixHQUFlQSxFQUFmO0FBQ0FFLEVBQUFBLFNBQVMsQ0FBQ1UsSUFBVixHQUFpQjtBQUNiLGtCQUFjLGdCQUREO0FBRWIsWUFBUSxPQUZLO0FBR2IsZ0JBQVksTUFIQztBQUliLGNBQVU7QUFDTixjQUFRO0FBQ0osZ0JBQVEsTUFESjtBQUVKLHFCQUFhLEVBRlQ7QUFHSixvQkFBWSxDQUNSLE1BRFEsQ0FIUjtBQU1KLHVCQUFlLE1BTlg7QUFPSixzQkFBYztBQVBWLE9BREY7QUFVTixzQkFBZ0I7QUFDWixnQkFBUSxNQURJO0FBRVosdUJBQWU7QUFGSCxPQVZWO0FBY04scUJBQWU7QUFDWCxnQkFBUSxNQURHO0FBRVgsdUJBQWU7QUFGSixPQWRUO0FBa0JOLGdCQUFVO0FBQ04sZ0JBQVEsTUFERjtBQUVOLHFCQUFhLElBRlA7QUFHTixxQkFBYSxDQUNUO0FBQ0kscUJBQVcsV0FEZjtBQUVJLGtCQUFRO0FBRlosU0FEUyxDQUhQO0FBU04sb0JBQVksQ0FDUixLQURRLENBVE47QUFZTix1QkFBZSxRQVpUO0FBYU4sc0JBQWM7QUFiUixPQWxCSjtBQWlDTixnQkFBVTtBQUNOLGdCQUFRLE9BREY7QUFFTixvQkFBWSxJQUZOO0FBR04sdUJBQWU7QUFIVCxPQWpDSjtBQXNDTixlQUFTO0FBQ0wsZ0JBQVEsTUFESDtBQUVMLHFCQUFhLElBRlI7QUFHTCxvQkFBWSxJQUhQO0FBSUwscUJBQWEsQ0FDVDtBQUNJLHFCQUFXLFdBRGY7QUFFSSxrQkFBUTtBQUZaLFNBRFMsQ0FKUjtBQVVMLG9CQUFZLENBQ1IsS0FEUSxDQVZQO0FBYUwsdUJBQWU7QUFiVixPQXRDSDtBQXFETixlQUFTO0FBQ0wsZ0JBQVEsTUFESDtBQUVMLHFCQUFhLElBRlI7QUFHTCxvQkFBWSxJQUhQO0FBSUwscUJBQWEsQ0FDVDtBQUNJLHFCQUFXLFdBRGY7QUFFSSxrQkFBUTtBQUZaLFNBRFMsQ0FKUjtBQVVMLG9CQUFZLENBQ1IsS0FEUSxDQVZQO0FBYUwsdUJBQWU7QUFiVixPQXJESDtBQW9FTixlQUFTO0FBQ0wsZ0JBQVEsTUFESDtBQUVMLHFCQUFhLEdBRlI7QUFHTCxxQkFBYSxDQUNUO0FBQ0kscUJBQVcsV0FEZjtBQUVJLGtCQUFRO0FBRlosU0FEUyxDQUhSO0FBU0wsb0JBQVksQ0FDUixPQURRLENBVFA7QUFZTCx1QkFBZSxPQVpWO0FBYUwsc0JBQWM7QUFiVCxPQXBFSDtBQW1GTixtQkFBYTtBQUNULGdCQUFRLE1BREM7QUFFVCxxQkFBYSxFQUZKO0FBR1Qsb0JBQVksQ0FDUixNQURRLENBSEg7QUFNVCx1QkFBZSxXQU5OO0FBT1Qsc0JBQWM7QUFQTCxPQW5GUDtBQTRGTixrQkFBWTtBQUNSLGdCQUFRLE1BREE7QUFFUixxQkFBYSxFQUZMO0FBR1Isb0JBQVksQ0FDUixNQURRLENBSEo7QUFNUix1QkFBZSxVQU5QO0FBT1Isc0JBQWM7QUFQTixPQTVGTjtBQXFHTixrQkFBWTtBQUNSLGdCQUFRLE1BREE7QUFFUixxQkFBYSxFQUZMO0FBR1Isb0JBQVksQ0FDUixNQURRLENBSEo7QUFNUix1QkFBZSxVQU5QO0FBT1Isc0JBQWM7QUFQTixPQXJHTjtBQThHTixxQkFBZTtBQUNYLGdCQUFRLE1BREc7QUFFWCxxQkFBYSxFQUZGO0FBR1gsb0JBQVksQ0FDUixNQURRLENBSEQ7QUFNWCx1QkFBZSxjQU5KO0FBT1gsc0JBQWM7QUFQSCxPQTlHVDtBQXVITixpQkFBVztBQUNQLGdCQUFRLE1BREQ7QUFFUCxxQkFBYSxHQUZOO0FBR1AsdUJBQWUsU0FIUjtBQUlQLHNCQUFjO0FBSlAsT0F2SEw7QUE2SE4sbUJBQWE7QUFDVCxnQkFBUSxVQURDO0FBRVQsZ0JBQVEsSUFGQztBQUdULG9CQUFZLElBSEg7QUFJVCxxQkFBYSxJQUpKO0FBS1QsdUJBQWUsWUFMTjtBQU1ULDZCQUFxQixJQU5aO0FBT1Qsc0JBQWM7QUFQTCxPQTdIUDtBQXNJTixtQkFBYTtBQUNULGdCQUFRLFVBREM7QUFFVCxvQkFBWSxJQUZIO0FBR1QsdUJBQWUsSUFITjtBQUlULG9CQUFZLElBSkg7QUFLVCx1QkFBZSxZQUxOO0FBTVQsNkJBQXFCLElBTlo7QUFPVCxzQkFBYztBQVBMLE9BdElQO0FBK0lOLG1CQUFhO0FBQ1QsZ0JBQVEsU0FEQztBQUVULG1CQUFXLEtBRkY7QUFHVCxvQkFBWSxJQUhIO0FBSVQsdUJBQWU7QUFKTixPQS9JUDtBQXFKTixpQkFBVztBQUNQLGdCQUFRLFNBREQ7QUFFUCx1QkFBZSxXQUZSO0FBR1Asc0JBQWM7QUFIUCxPQXJKTDtBQTBKTixnQkFBVTtBQUNOLGdCQUFRLE1BREY7QUFFTixxQkFBYSxFQUZQO0FBR04sb0JBQVksQ0FDUixNQURRLENBSE47QUFNTix1QkFBZSxZQU5UO0FBT04sc0JBQWM7QUFQUjtBQTFKSixLQUpHO0FBd0tiLGdCQUFZO0FBQ1IseUJBQW1CO0FBQ2YsaUJBQVM7QUFETSxPQURYO0FBSVIseUJBQW1CO0FBQ2YsaUJBQVM7QUFETSxPQUpYO0FBT1IseUJBQW1CO0FBQ2YsaUJBQVMsV0FETTtBQUVmLGlCQUFTO0FBRk07QUFQWCxLQXhLQztBQW9MYixrQkFBYyxDQUNWLENBQ0ksTUFESixDQURVLENBcExEO0FBeUxiLG9CQUFnQjtBQUNaLGlCQUFXO0FBQ1Asa0JBQVUsU0FESDtBQUVQLGtCQUFVO0FBRkgsT0FEQztBQUtaLGdCQUFVO0FBQ04sa0JBQVUsUUFESjtBQUVOLGtCQUFVO0FBRkosT0FMRTtBQVNaLGtCQUFZO0FBQ1Isa0JBQVUsY0FERjtBQUVSLGtCQUFVLElBRkY7QUFHUix1QkFBZTtBQUhQO0FBVEEsS0F6TEg7QUF3TWIseUJBQXFCO0FBQ2pCLG1CQUFhLENBQ1QsV0FEUztBQURJO0FBeE1SLEdBQWpCO0FBK01BLFNBQU9JLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjZixTQUFkLEVBQXlCLEVBQXpCLENBQVA7QUFDSCxDQXBRRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcblxuY29uc3QgeyBcbiAgICBUeXBlcyxcbiAgICBWYWxpZGF0b3JzLCBcbiAgICBQcm9jZXNzb3JzLCBcbiAgICBHZW5lcmF0b3JzLCBcbiAgICBFcnJvcnM6IHsgQnVzaW5lc3NFcnJvciwgRGF0YVZhbGlkYXRpb25FcnJvciwgRHNPcGVyYXRpb25FcnJvciB9LCBcbiAgICBVdGlsczogeyBMYW5nOiB7IGlzTm90aGluZyB9IH0gXG59ID0gcmVxdWlyZSgnQGstc3VpdGUvb29sb25nJyk7XG4gXG5cbm1vZHVsZS5leHBvcnRzID0gKGRiLCBCYXNlRW50aXR5TW9kZWwpID0+IHtcbiAgICBjb25zdCBSb2JvdFNwZWMgPSBjbGFzcyBleHRlbmRzIEJhc2VFbnRpdHlNb2RlbCB7ICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQXBwbHlpbmcgcHJlZGVmaW5lZCBtb2RpZmllcnMgdG8gZW50aXR5IGZpZWxkcy5cbiAgICAgICAgICogQHBhcmFtIGNvbnRleHRcbiAgICAgICAgICogQHBhcmFtIGlzVXBkYXRpbmdcbiAgICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgYXN5bmMgYXBwbHlNb2RpZmllcnNfKGNvbnRleHQsIGlzVXBkYXRpbmcpIHtcbiAgICAgICAgICAgIGxldCB7cmF3LCBsYXRlc3QsIGV4aXN0aW5nLCBpMThufSA9IGNvbnRleHQ7XG4gICAgICAgICAgICBleGlzdGluZyB8fCAoZXhpc3RpbmcgPSB7fSk7XG4gICAgICAgICAgICBpZiAoIWlzTm90aGluZyhsYXRlc3RbJ2F2YXRhciddKSkge1xuICAgICAgICAgICAgICAgIC8vVmFsaWRhdGluZyBcImF2YXRhclwiXG4gICAgICAgICAgICAgICAgaWYgKCFWYWxpZGF0b3JzLmlzVVJMKGxhdGVzdFsnYXZhdGFyJ10pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBEYXRhVmFsaWRhdGlvbkVycm9yKCdJbnZhbGlkIFwiYXZhdGFyXCIuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5OiB0aGlzLm1ldGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnYXZhdGFyJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWlzTm90aGluZyhsYXRlc3RbJ3ZpZGVvJ10pKSB7XG4gICAgICAgICAgICAgICAgLy9WYWxpZGF0aW5nIFwidmlkZW9cIlxuICAgICAgICAgICAgICAgIGlmICghVmFsaWRhdG9ycy5pc1VSTChsYXRlc3RbJ3ZpZGVvJ10pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBEYXRhVmFsaWRhdGlvbkVycm9yKCdJbnZhbGlkIFwidmlkZW9cIi4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHk6IHRoaXMubWV0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICd2aWRlbydcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpc05vdGhpbmcobGF0ZXN0Wyd2b2ljZSddKSkge1xuICAgICAgICAgICAgICAgIC8vVmFsaWRhdGluZyBcInZvaWNlXCJcbiAgICAgICAgICAgICAgICBpZiAoIVZhbGlkYXRvcnMuaXNVUkwobGF0ZXN0Wyd2b2ljZSddKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGF0YVZhbGlkYXRpb25FcnJvcignSW52YWxpZCBcInZvaWNlXCIuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5OiB0aGlzLm1ldGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAndm9pY2UnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaXNOb3RoaW5nKGxhdGVzdFsnZW1haWwnXSkpIHtcbiAgICAgICAgICAgICAgICAvL1ZhbGlkYXRpbmcgXCJlbWFpbFwiXG4gICAgICAgICAgICAgICAgaWYgKCFWYWxpZGF0b3JzLmlzRW1haWwobGF0ZXN0WydlbWFpbCddKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGF0YVZhbGlkYXRpb25FcnJvcignSW52YWxpZCBcImVtYWlsXCIuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5OiB0aGlzLm1ldGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnZW1haWwnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFJvYm90U3BlYy5kYiA9IGRiO1xuICAgIFJvYm90U3BlYy5tZXRhID0ge1xuICAgICAgICBcInNjaGVtYU5hbWVcIjogXCJsZXZvRm91bmRhdGlvblwiLFxuICAgICAgICBcIm5hbWVcIjogXCJyb2JvdFwiLFxuICAgICAgICBcImtleUZpZWxkXCI6IFwiY29kZVwiLFxuICAgICAgICBcImZpZWxkc1wiOiB7XG4gICAgICAgICAgICBcImNvZGVcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICBcIm1heExlbmd0aFwiOiAyMCxcbiAgICAgICAgICAgICAgICBcInN1YkNsYXNzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJjb2RlXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJDb2RlXCIsXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVCeURiXCI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImludHJvZHVjdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJJbnRyb2R1Y3Rpb25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidm9pY2VTY3JpcHRcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiVm9pY2UgU2NyaXB0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImF2YXRhclwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIFwibWF4TGVuZ3RoXCI6IDIwMDAsXG4gICAgICAgICAgICAgICAgXCJtb2RpZmllcnNcIjogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJWYWxpZGF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImlzVVJMXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJzdWJDbGFzc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwidXJsXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJBdmF0YXJcIixcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiaW1hZ2VzXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJhcnJheVwiLFxuICAgICAgICAgICAgICAgIFwib3B0aW9uYWxcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiSW1hZ2VzXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInZpZGVvXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJtYXhMZW5ndGhcIjogMjAwMCxcbiAgICAgICAgICAgICAgICBcIm9wdGlvbmFsXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJtb2RpZmllcnNcIjogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJWYWxpZGF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImlzVVJMXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJzdWJDbGFzc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwidXJsXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJWaWRlb1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ2b2ljZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIFwibWF4TGVuZ3RoXCI6IDIwMDAsXG4gICAgICAgICAgICAgICAgXCJvcHRpb25hbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwibW9kaWZpZXJzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJvb2xUeXBlXCI6IFwiVmFsaWRhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJpc1VSTFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwic3ViQ2xhc3NcIjogW1xuICAgICAgICAgICAgICAgICAgICBcInVybFwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiVm9pY2VcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZW1haWxcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICBcIm1heExlbmd0aFwiOiAyMDAsXG4gICAgICAgICAgICAgICAgXCJtb2RpZmllcnNcIjogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJWYWxpZGF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImlzRW1haWxcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcInN1YkNsYXNzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiRW1haWxcIixcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZmlyc3RuYW1lXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJtYXhMZW5ndGhcIjogNDAsXG4gICAgICAgICAgICAgICAgXCJzdWJDbGFzc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiRmlyc3RuYW1lXCIsXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVCeURiXCI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImxhc3RuYW1lXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJtYXhMZW5ndGhcIjogNDAsXG4gICAgICAgICAgICAgICAgXCJzdWJDbGFzc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiTGFzdG5hbWVcIixcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibmlja25hbWVcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICBcIm1heExlbmd0aFwiOiA0MCxcbiAgICAgICAgICAgICAgICBcInN1YkNsYXNzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJOaWNrbmFtZVwiLFxuICAgICAgICAgICAgICAgIFwiY3JlYXRlQnlEYlwiOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJleHBlcnRUaXRsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIFwibWF4TGVuZ3RoXCI6IDQwLFxuICAgICAgICAgICAgICAgIFwic3ViQ2xhc3NcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcIkV4cGVydCBUaXRsZVwiLFxuICAgICAgICAgICAgICAgIFwiY3JlYXRlQnlEYlwiOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJhZGRyZXNzXCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJtYXhMZW5ndGhcIjogMjAwLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJBZGRyZXNzXCIsXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVCeURiXCI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNyZWF0ZWRBdFwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiZGF0ZXRpbWVcIixcbiAgICAgICAgICAgICAgICBcImF1dG9cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcInJlYWRPbmx5XCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJ3cml0ZU9uY2VcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwiQ3JlYXRlZCBBdFwiLFxuICAgICAgICAgICAgICAgIFwiaXNDcmVhdGVUaW1lc3RhbXBcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidXBkYXRlZEF0XCI6IHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJkYXRldGltZVwiLFxuICAgICAgICAgICAgICAgIFwicmVhZE9ubHlcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcImZvcmNlVXBkYXRlXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJvcHRpb25hbFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJVcGRhdGVkIEF0XCIsXG4gICAgICAgICAgICAgICAgXCJpc1VwZGF0ZVRpbWVzdGFtcFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwidXBkYXRlQnlEYlwiOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJpc0RlbGV0ZWRcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcImJvb2xlYW5cIixcbiAgICAgICAgICAgICAgICBcImRlZmF1bHRcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgXCJyZWFkT25seVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwiZGlzcGxheU5hbWVcIjogXCJJcyBEZWxldGVkXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInNlcnZpY2VcIjoge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcImludGVnZXJcIixcbiAgICAgICAgICAgICAgICBcImRpc3BsYXlOYW1lXCI6IFwic2VydmljZUlkXCIsXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVCeURiXCI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdlbmRlclwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgIFwibWF4TGVuZ3RoXCI6IDIwLFxuICAgICAgICAgICAgICAgIFwic3ViQ2xhc3NcIjogW1xuICAgICAgICAgICAgICAgICAgICBcImNvZGVcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkaXNwbGF5TmFtZVwiOiBcImdlbmRlckNvZGVcIixcbiAgICAgICAgICAgICAgICBcImNyZWF0ZUJ5RGJcIjogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImZlYXR1cmVzXCI6IHtcbiAgICAgICAgICAgIFwiY3JlYXRlVGltZXN0YW1wXCI6IHtcbiAgICAgICAgICAgICAgICBcImZpZWxkXCI6IFwiY3JlYXRlZEF0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInVwZGF0ZVRpbWVzdGFtcFwiOiB7XG4gICAgICAgICAgICAgICAgXCJmaWVsZFwiOiBcInVwZGF0ZWRBdFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJsb2dpY2FsRGVsZXRpb25cIjoge1xuICAgICAgICAgICAgICAgIFwiZmllbGRcIjogXCJpc0RlbGV0ZWRcIixcbiAgICAgICAgICAgICAgICBcInZhbHVlXCI6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJ1bmlxdWVLZXlzXCI6IFtcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBcImNvZGVcIlxuICAgICAgICAgICAgXVxuICAgICAgICBdLFxuICAgICAgICBcImFzc29jaWF0aW9uc1wiOiB7XG4gICAgICAgICAgICBcInNlcnZpY2VcIjoge1xuICAgICAgICAgICAgICAgIFwiZW50aXR5XCI6IFwic2VydmljZVwiLFxuICAgICAgICAgICAgICAgIFwiaXNMaXN0XCI6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJnZW5kZXJcIjoge1xuICAgICAgICAgICAgICAgIFwiZW50aXR5XCI6IFwiZ2VuZGVyXCIsXG4gICAgICAgICAgICAgICAgXCJpc0xpc3RcIjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbnRhY3RzXCI6IHtcbiAgICAgICAgICAgICAgICBcImVudGl0eVwiOiBcInJvYm90Q29udGFjdFwiLFxuICAgICAgICAgICAgICAgIFwiaXNMaXN0XCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJyZW1vdGVGaWVsZFwiOiBcInJvYm90XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJmaWVsZERlcGVuZGVuY2llc1wiOiB7XG4gICAgICAgICAgICBcImNyZWF0ZWRBdFwiOiBbXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVkQXRcIlxuICAgICAgICAgICAgXVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKFJvYm90U3BlYywge30pO1xufTsiXX0=
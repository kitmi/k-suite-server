"use strict";

require("source-map-support/register");

const {
  Feature
} = require('..').enum;

const {
  tryRequire
} = require('@k-suite/app/lib/utils/Helpers');

const {
  InvalidConfiguration
} = require('../Errors');

const {
  fs
} = require('rk-utils');

module.exports = {
  type: Feature.SERVICE,
  load_: async function (app, options) {
    if (!options || typeof options.serviceAccount !== 'string') {
      throw new InvalidConfiguration('Missing required configuration item "firebase.serviceAccount".');
    }

    const admin = tryRequire('firebase-admin');
    const serviceAccount = await fs.readJson(options.serviceAccount, 'utf8');
    const firebaseAdminApp = admin.initializeApp({
      credential: admin.credential.cert(serviceAccount)
    });
    app.registerService('firebaseAdmin', firebaseAdminApp);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9maXJlYmFzZUFkbWluLmpzIl0sIm5hbWVzIjpbIkZlYXR1cmUiLCJyZXF1aXJlIiwiZW51bSIsInRyeVJlcXVpcmUiLCJJbnZhbGlkQ29uZmlndXJhdGlvbiIsImZzIiwibW9kdWxlIiwiZXhwb3J0cyIsInR5cGUiLCJTRVJWSUNFIiwibG9hZF8iLCJhcHAiLCJvcHRpb25zIiwic2VydmljZUFjY291bnQiLCJhZG1pbiIsInJlYWRKc29uIiwiZmlyZWJhc2VBZG1pbkFwcCIsImluaXRpYWxpemVBcHAiLCJjcmVkZW50aWFsIiwiY2VydCIsInJlZ2lzdGVyU2VydmljZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBY0MsT0FBTyxDQUFDLElBQUQsQ0FBUCxDQUFjQyxJQUFsQzs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBaUJGLE9BQU8sQ0FBQyxnQ0FBRCxDQUE5Qjs7QUFDQSxNQUFNO0FBQUVHLEVBQUFBO0FBQUYsSUFBMkJILE9BQU8sQ0FBQyxXQUFELENBQXhDOztBQUNBLE1BQU07QUFBRUksRUFBQUE7QUFBRixJQUFTSixPQUFPLENBQUMsVUFBRCxDQUF0Qjs7QUFFQUssTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBTWJDLEVBQUFBLElBQUksRUFBRVIsT0FBTyxDQUFDUyxPQU5EO0FBZWJDLEVBQUFBLEtBQUssRUFBRSxnQkFBZ0JDLEdBQWhCLEVBQXFCQyxPQUFyQixFQUE4QjtBQUNqQyxRQUFJLENBQUNBLE9BQUQsSUFBWSxPQUFPQSxPQUFPLENBQUNDLGNBQWYsS0FBa0MsUUFBbEQsRUFBNEQ7QUFDeEQsWUFBTSxJQUFJVCxvQkFBSixDQUF5QixnRUFBekIsQ0FBTjtBQUNIOztBQUVELFVBQU1VLEtBQUssR0FBR1gsVUFBVSxDQUFDLGdCQUFELENBQXhCO0FBRUEsVUFBTVUsY0FBYyxHQUFHLE1BQU1SLEVBQUUsQ0FBQ1UsUUFBSCxDQUFZSCxPQUFPLENBQUNDLGNBQXBCLEVBQW9DLE1BQXBDLENBQTdCO0FBRUEsVUFBTUcsZ0JBQWdCLEdBQUdGLEtBQUssQ0FBQ0csYUFBTixDQUFvQjtBQUN6Q0MsTUFBQUEsVUFBVSxFQUFFSixLQUFLLENBQUNJLFVBQU4sQ0FBaUJDLElBQWpCLENBQXNCTixjQUF0QjtBQUQ2QixLQUFwQixDQUF6QjtBQUlBRixJQUFBQSxHQUFHLENBQUNTLGVBQUosQ0FBb0IsZUFBcEIsRUFBcUNKLGdCQUFyQztBQUNIO0FBN0JZLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogRW5hYmxlIGZpcmViYXNlIGZlYXR1cmUuXG4gKiBAbW9kdWxlIEZlYXR1cmVfRmlyZWJhc2VcbiAqL1xuXG5jb25zdCB7IEZlYXR1cmUgfSA9IHJlcXVpcmUoJy4uJykuZW51bTtcbmNvbnN0IHsgdHJ5UmVxdWlyZSB9ID0gcmVxdWlyZSgnQGstc3VpdGUvYXBwL2xpYi91dGlscy9IZWxwZXJzJyk7XG5jb25zdCB7IEludmFsaWRDb25maWd1cmF0aW9uIH0gPSByZXF1aXJlKCcuLi9FcnJvcnMnKTtcbmNvbnN0IHsgZnMgfSA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBzZXJ2aWNlIHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuU0VSVklDRSxcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGFwcCBtb2R1bGUgb2JqZWN0XG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zIGZvciB0aGUgZmVhdHVyZVxuICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBvcHRpb25zLnNlcnZpY2VBY2NvdW50IC0gVGhlIHNlcml2Y2VBY2NvdW50IGNvbmZpZyBmaWxlIHBhdGguXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPCo+fVxuICAgICAqL1xuICAgIGxvYWRfOiBhc3luYyBmdW5jdGlvbiAoYXBwLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghb3B0aW9ucyB8fCB0eXBlb2Ygb3B0aW9ucy5zZXJ2aWNlQWNjb3VudCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkQ29uZmlndXJhdGlvbignTWlzc2luZyByZXF1aXJlZCBjb25maWd1cmF0aW9uIGl0ZW0gXCJmaXJlYmFzZS5zZXJ2aWNlQWNjb3VudFwiLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWRtaW4gPSB0cnlSZXF1aXJlKCdmaXJlYmFzZS1hZG1pbicpO1xuXG4gICAgICAgIGNvbnN0IHNlcnZpY2VBY2NvdW50ID0gYXdhaXQgZnMucmVhZEpzb24ob3B0aW9ucy5zZXJ2aWNlQWNjb3VudCwgJ3V0ZjgnKTtcblxuICAgICAgICBjb25zdCBmaXJlYmFzZUFkbWluQXBwID0gYWRtaW4uaW5pdGlhbGl6ZUFwcCh7XG4gICAgICAgICAgICBjcmVkZW50aWFsOiBhZG1pbi5jcmVkZW50aWFsLmNlcnQoc2VydmljZUFjY291bnQpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFwcC5yZWdpc3RlclNlcnZpY2UoJ2ZpcmViYXNlQWRtaW4nLCBmaXJlYmFzZUFkbWluQXBwKTtcbiAgICB9XG59OyJdfQ==